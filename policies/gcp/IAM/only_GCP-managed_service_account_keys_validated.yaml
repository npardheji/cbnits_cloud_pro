policies:
  - name: only_GCP-managed_service_account_keys_enforced
    description: |
      Ensure that there are only GCP-managed service account keys for each service account
    resource: gcp.service-account-key
    filters:
      - not:
        - type: value
          key: keyType
          value: SYSTEM_MANAGED
    actions:
    - type: webhook
      url: 'https://hooks.slack.com/services/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'
      body: |-
        {
          "attachments": [
            {
              "fallback": `CloudCustodian Policy Violation`,
              "title": policy.description,
              "color": `danger`,
              "fields": [
                {
                  "title": `Priority`,
                  "value": `High`,
                  "short": `true`
                },
                {
                  "title": `Bucket Name`,
                  "value": resource.name,
                  "short": `true`
                },
                {
                  "title": `Bucket selfLink`,
                  "value": resource.selfLink,
                  "short": `false`
                }
              ],
              "footer": `Powered By Nikhil`,
              "thumb_url": `https://play-lh.googleusercontent.com/lV1DhBeSuikQy6fLPhgfNHUxDqterNlur4oB1Z_Yr0NOSiWwQOD0g8gWCjVf1mmMuw`,
              "footer_icon": "https://platform.slack-edge.com/img/default_application_icon.png"
            }
          ]
        }